/**
 * Created by a.amrastanov on 08.11.2014.
 */

var gcm = require('node-gcm');

var GCMService = {
    sender: new gcm.Sender('AIzaSyDhpknxMq3XiKywfkeW-iYIH3ZA5VS9KJc'),
    send: function(user, messageBody, key){
        var message = new gcm.Message({
            collapseKey: key,
            delayWhileIdle: true,
            timeToLive: 1,
            data: messageBody
        });
        var registrationIds = [user.data.gcmId];
        GCMService.sender.send(message, registrationIds, 1, function (err, result) {
            require('out').action("GCM sended", message,
                {'userId' :user.data.id, 'userToken' : user.data.token, 'gcmId' : user.data.gcmId});
            if (err){
                require('out').error("GSM send error", err);
            }
            else{
                require('out').action("GSM send success", result);
            }
        });
    }
};

module.exports = GCMService;