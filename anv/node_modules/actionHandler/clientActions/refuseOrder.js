/**
 * Created by a.amrastanov on 26.10.2014.
 */

module.exports = function(parameterMap){
    this.clientToken = parameterMap.token;
    this.action = parameterMap.action;
    this.doAction = function(){
        var clientHandler = require('userHandler').clientHandler;
        var client = clientHandler.getUserByToken(this.clientToken);
        var order = client.getOrder();
        if (order === undefined){
            return require('contextHandler').NewErrorMessage(this.action, require('errorCodes').no_client_order_in_server);
        }
        else{
            var taksist = order.getTaksist();
            client.removeOrder();
            taksist.removeOrder();
            var actionHandler = require('actionHandler');
            actionHandler.serverActionHandler.doAction({
                action:actionHandler.serverActionsValues.sendOrderRemoveToTaksist,
                taksist: taksist
            });
            require('db').orderActionDb.insertNew(order.data.id, require('db').ORDER_ACTIONS.CLIENT_REFUSE);
            require('orderHandler').removeOrder(order);
        }
    }
};
