/**
 * Created by a.amrastanov on 13.08.2014.
 */

module.exports = function(parameterMap){
    this.clientToken = parameterMap.token;
    this.doAction = function(){
        var client = require('userHandler').clientHandler.getUserByToken(this.clientToken);
        var issue = client.getIssue();
        if (issue){
            var actionHandler = require('actionHandler');
            actionHandler.serverActionHandler.doAction({
                action:actionHandler.serverActionsValues.sendIssueRemoveToTaksists,
                issue: issue
            });
            issue.removeUsers();
            require('db').issueActionDb.insertNew(issue.data.id, require('db').ISSUE_ACTIONS.HAND_CANCEL);
            require('issueHandler').removeIssue(issue);
        }
    }
};